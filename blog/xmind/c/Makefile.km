{"root":{"data":{"id":"a240e5b9b29d","created":1473253819,"text":"跟我一起写Makefile"},"children":[{"data":{"id":"b6y9mo11augo","created":1473255897738,"text":"1 Makefile规则","expandState":"collapse"},"children":[{"data":{"id":"b6y9n0zgh60o","created":1473255925940,"text":"规则"},"children":[{"data":{"id":"b6y9q7eedpko","created":1473256174997,"text":"target ...: prerequisites ...\n   command\n   ..."},"children":[{"data":{"id":"b6y9r2py00wg","created":1473256243175,"text":"target"},"children":[{"data":{"id":"b6y9r7wsj4wk","created":1473256254474,"text":"目标文件"},"children":[]},{"data":{"id":"c0eoj24qwrk0","created":1580951485698,"text":"执行文件"},"children":[]},{"data":{"id":"b6y9rdf7mdc0","created":1473256266471,"text":"标签"},"children":[]}]},{"data":{"id":"c0eojygconk0","created":1580951556056,"text":"prerequiesites"},"children":[{"data":{"id":"c0eoka9u9w80","created":1580951581784,"text":"生成该target所依赖的文件和/或target"},"children":[]}]},{"data":{"id":"c0eokipyi4w0","created":1580951600173,"text":"command"},"children":[{"data":{"id":"c0eoko6rads0","created":1580951612073,"text":"该target要执行的命令"},"children":[]}]}]}]},{"data":{"id":"b6y9n47b7h4c","created":1473255932946,"text":"如何工作"},"children":[{"data":{"id":"b6yaj3ilp748","created":1473258439105,"text":"找文件","expandState":"expand"},"children":[{"data":{"id":"b6yaj8i5ewow","created":1473258449961,"text":"Makefile"},"children":[]},{"data":{"id":"b6yajasj78gg","created":1473258454943,"text":"makefile"},"children":[]}]},{"data":{"id":"b6yaq15cdp4c","created":1473258982500,"text":"文件中第一个目标文件"},"children":[]},{"data":{"id":"b6yaqhkz90oo","created":1473259018273,"text":"target不存在或target后依赖的.o文件比target新，则执行command"},"children":[]},{"data":{"id":"b6yaua2y7ncw","created":1473259315402,"text":"make会一层层找文件的依赖关系，直到完成"},"children":[]},{"data":{"id":"b6yawcxf65cg","created":1473259478326,"text":"修改源码后，target会被重新执行"},"children":[]}]},{"data":{"id":"b6yb3eoqka8s","created":1473260030704,"text":"使用变量"},"children":[{"data":{"id":"b6yb3wnraw0k","created":1473260069828,"text":"objects = main.o kbd.o command.o display.o \\\n\t     insert.o search.o files.o utils.o //大小写敏感"},"children":[]},{"data":{"id":"b6yb4pgcbps8","created":1473260132505,"text":"使用变量","note":"edit : $(objects) \n\tcc -o edit $(objects)"},"children":[]}]},{"data":{"id":"b6y9n7ek7c0g","created":1473255939914,"text":"让make自动推导"},"children":[{"data":{"id":"b6yb9ds7k084","created":1473260498922,"text":"make看到[.o]文件，就会自动把[.c]加入依赖","note":"objects = main.o kbd.o command.o display.o insert.o search.o files.o utils.o\n\nedit : $(objects)\n    cc -o edit $(objects)\n\nmain.o : defs.h\n\nkbd.o : defs.h command.h\n\ncommand.o : defs.h command.h\n\ndisplay.o : defs.h buffer.h\n\ninsert.o : defs.h buffer.h\n\nsearch.o : defs.h buffer.h\n\nfiles.o : defs.h buffer.h command.h\n\nutils.o : defs.h\n\n.PHONY : clean\n\nclean :\n    rm edit $(objects)"},"children":[]},{"data":{"id":"b6ybc7xfucoo","created":1473260721270,"text":".PHONY表示，clean是个伪目标文件"},"children":[]}]},{"data":{"id":"b6y9nbcfeigw","created":1473255948493,"text":"另类风格"},"children":[{"data":{"id":"b6ybdfbcj7s4","created":1473260815713,"text":"重复.h文件合并","note":"objects = main.o kbd.o command.o display.o insert.o search.o files.o utils.o\n\nedit : $(objects)\n    cc -o edit $(objects)\n \n$(objects) : defs.h\n\nkbd.o command.o files.o : command.h\n \ndisplay.o insert.o search.o files.o : buffer.h\n \n.PHONY : clean\n \nclean :\n     rm edit $(objects)"},"children":[]}]},{"data":{"id":"b6y9nf7rbkwg","created":1473255956917,"text":"清空目标文件规则"},"children":[{"data":{"id":"b6ybh7rnlpss","created":1473261112741,"text":"用途","expandState":"expand"},"children":[{"data":{"id":"b6ybhb2es4ws","created":1473261119922,"text":"便于重新编译，保持文件清洁"},"children":[]}]},{"data":{"id":"b6ybi5wkbk00","created":1473261187048,"text":"一般风格","note":"```\nclear:\n    rm edit $(objects)\n```    "},"children":[]},{"data":{"id":"b6ybilqq4iog","created":1473261221524,"text":"更稳健做法","note":"```\n.PHONY : clean\n\nclean :\n    -rm edit $(objects)\n```    ","expandState":"expand"},"children":[{"data":{"id":"b6yc1n5nnncw","created":1473262713523,"text":"在rm命令前面加了一个小减号的意思就是，也许某些文件出现问题，但不要管，继续做后面的事。"},"children":[]},{"data":{"id":"b6yc23h8slk4","created":1473262749052,"text":"不成文的规矩是——clean从来都是放在文件的最后。"},"children":[]}]}]}]},{"data":{"id":"b6y9nlllls84","created":1473255970815,"text":"2 Makefile总述","expandState":"collapse","note":"在rm命令前面加了一个小减号的意思就是，也许某些文件出现问题，但不要管，继续做后面的事。"},"children":[{"data":{"id":"b6y9npr7pdcs","created":1473255979862,"text":"文件里有什么"},"children":[{"data":{"id":"b6ybl6vq6coo","created":1473261424267,"text":"显式规则"},"children":[{"data":{"id":"b6ybmfqiq0ow","created":1473261521907,"text":"如何生成一个或多的的目标文件"},"children":[]},{"data":{"id":"b6ybnrr7omww","created":1473261626435,"text":"要生成的文件"},"children":[]},{"data":{"id":"b6ybnvnyumo8","created":1473261634946,"text":"文件的依赖文件"},"children":[]},{"data":{"id":"b6ybny8z37s4","created":1473261640570,"text":"生成的命令"},"children":[{"data":{"id":"b6ybya0gkq0o","created":1473262449818,"text":"在Makefile中的命令，必须要以[Tab]键开始"},"children":[]}]}]},{"data":{"id":"b6yblbgbxlsg","created":1473261434221,"text":"隐晦规则"},"children":[{"data":{"id":"b6ybo56maagc","created":1473261655665,"text":"可以让我们简略粗糙地写Makefile"},"children":[]}]},{"data":{"id":"b6yblzubfe8s","created":1473261487310,"text":"变量定义"},"children":[{"data":{"id":"b6ybpeevw0wk","created":1473261754120,"text":"变量定义一般为字符串"},"children":[]},{"data":{"id":"b6ybpjbs99ko","created":1473261764816,"text":"Makefile被执行时，其中的变量都会被扩展到相应的引用位置上"},"children":[]}]},{"data":{"id":"b6ybm4glr8oo","created":1473261497363,"text":"文件指示","expandState":"expand"},"children":[{"data":{"id":"b6ybs8deae8g","created":1473261976061,"text":"引用另一个Makefile"},"children":[]},{"data":{"id":"b6ybuurogbcc","created":1473262181543,"text":"根据某些情况，指定Makefile中的有效部分（类似c中的预编译#if）"},"children":[]},{"data":{"id":"b6ybvvdokuo8","created":1473262261237,"text":"定义一个多行的命令"},"children":[]}]},{"data":{"id":"b6ybm9nh9bks","created":1473261508663,"text":"注释"},"children":[{"data":{"id":"b6ybxfo74rkk","created":1473262383774,"text":"仅能行注释，以#开头"},"children":[]}]}]},{"data":{"id":"b6y9nw43gx4o","created":1473255993701,"text":"文件名","expandState":"expand"},"children":[{"data":{"id":"b6yc32cwxlkc","created":1473262824977,"text":"按顺序查找GUNmakefile/makefile/Makefile"},"children":[]},{"data":{"id":"b6yc3o4flgoo","created":1473262872354,"text":"最好使用Makefile"},"children":[]},{"data":{"id":"b6yc4048lr4k","created":1473262898463,"text":"可以用别的文件名"},"children":[{"data":{"id":"b6yc48rfbows","created":1473262917281,"text":"如Make.Linux/Make.Solaris/Make.AIX"},"children":[]},{"data":{"id":"b6yc4rtq31ck","created":1473262958778,"text":"make -f Make.Linux"},"children":[]},{"data":{"id":"b6yc4z2q480k","created":1473262974559,"text":"make --file Make.AIX"},"children":[]}]}]},{"data":{"id":"b6y9ny2uduok","created":1473255997979,"text":"引用其它的Makefile"},"children":[{"data":{"id":"b6yc5o51sc0s","created":1473263029119,"text":"include  foo.make *.mk $(bar)"},"children":[{"data":{"id":"b6yc6r23p2go","created":1473263113836,"text":"等价于 include foo.make a.mk b.mk c.mk e.mk f.mk"},"children":[]}]},{"data":{"id":"b6ycabc2wpkc","created":1473263393067,"text":"当前目录下查找"},"children":[]},{"data":{"id":"b6ycb08yuu0c","created":1473263447299,"text":"make -I [--include-dir] path 中查找"},"children":[]},{"data":{"id":"b6ycdgmyt5sg","created":1473263639702,"text":"/usr/local/include  /usr/include中查找"},"children":[]},{"data":{"id":"b6ycepuxgvks","created":1473263738138,"text":"如果引用没有被找到，生成一条警告，但不会马上出现致命错误。完成makefile的读取，make会重新读取，还不行，就报错"},"children":[]},{"data":{"id":"c0ez0wmf87s0","created":1580981095360,"text":"为避免报错，可以include前加减号    -include file"},"children":[]}]},{"data":{"id":"b6y9o2ofva8g","created":1473256007992,"text":"环境变量 MAKEFILES"},"children":[{"data":{"id":"b6ycimau3xck","created":1473264043850,"text":"不推荐使用"},"children":[]}]},{"data":{"id":"b6y9oeqcxy0c","created":1473256034229,"text":"make的工作方式","expandState":"expand"},"children":[{"data":{"id":"b6ycj528mhc8","created":1473264084689,"text":"1 读入所有的Makefile"},"children":[]},{"data":{"id":"b6ycj9k5cwg8","created":1473264094479,"text":"2 读入被include的其它Makefile"},"children":[]},{"data":{"id":"b6ycj9cfh2go","created":1473264094012,"text":"3 初始化文件中的变量"},"children":[]},{"data":{"id":"b6ycjnw99hc0","created":1473264125686,"text":"4 推导隐晦规则，并分析所有规则"},"children":[]},{"data":{"id":"b6ycjruncgoc","created":1473264134296,"text":"5 为所有的目标文件创建依赖关系链"},"children":[]},{"data":{"id":"b6ycjve2w3k0","created":1473264142001,"text":"6 根据依赖关系，决定哪些目标要重新生成"},"children":[]},{"data":{"id":"b6ycjyuxsa0o","created":1473264149551,"text":"7 执行生成命令"},"children":[]}]}]},{"data":{"id":"b6ycllq2o084","created":1473264277687,"text":"3 Makefile书写规则","expandState":"collapse"},"children":[{"data":{"id":"b6ycvgy7n6og","created":1473265050937,"text":"3.1 Makefile书写规则","expandState":"expand"},"children":[{"data":{"id":"b6ycnphbark0","created":1473264442593,"text":"规则包含两部分"},"children":[{"data":{"id":"c0fkvt3vo0w0","created":1581042760305,"text":"依赖关系"},"children":[]},{"data":{"id":"c0fkvzhjh400","created":1581042774192,"text":"生成目标的方法"},"children":[]}]},{"data":{"id":"b6ycnphbark0","created":1473264442593,"text":"第一条规则中的目标将被确立为最终的目标"},"children":[]},{"data":{"id":"b6yco3exdz40","created":1473264472923,"text":"如果第一条规则中的目标有很多个，那么，第一个目标会成为最终的目标"},"children":[]}]},{"data":{"id":"b6ycr1q3mjcc","created":1473264704338,"text":"3.2 规则语法","expandState":"expand"},"children":[{"data":{"id":"b6ycsdu0ihsg","created":1473264809060,"text":"targets: prerequisites\n    command\n    command\n    ..."},"children":[]},{"data":{"id":"b6ycm2cho68g","created":1473264313871,"text":"规则说明"},"children":[{"data":{"id":"b6ycn1i1ze8s","created":1473264390395,"text":"targets"},"children":[{"data":{"id":"b6yd002a1m8s","created":1473265405998,"text":"以空格分开，可使用通配符"},"children":[]},{"data":{"id":"b6yd0cxdn2o8","created":1473265434000,"text":"目标基本上是一个文件，也有可能是多个文件"},"children":[]}]},{"data":{"id":"b6ycn7wtj0o4","created":1473264404348,"text":"command [生成目标的方法]"},"children":[{"data":{"id":"b71da25netk4","created":1473570874067,"text":"如果和prerequisites在一行，那么可以用分号做为分隔"},"children":[]},{"data":{"id":"b6ycyrh8lfs4","created":1473265308947,"text":"若不在一行上，必须以Tab键开头"},"children":[]},{"data":{"id":"b6yd2uf7n34g","created":1473265628812,"text":"make会以UNIX的标准/bin/sh来执行命令"},"children":[]}]},{"data":{"id":"b6yczsixbjsw","created":1473265389590,"text":"prerequisites"},"children":[{"data":{"id":"b6yd123d92ww","created":1473265488782,"text":"目标所依赖的文件"},"children":[]},{"data":{"id":"b6yd1c2x508c","created":1473265510522,"text":"如果命令太长，你可以使用\\作为换行符"},"children":[]},{"data":{"id":"b6yd23up7ooo","created":1473265570975,"text":"make对一行上有多少个字符没限制"},"children":[]}]}]}]},{"data":{"id":"b6yd3mxmwywo","created":1473265690876,"text":"3.3 在规则中使用通配符","expandState":"expand"},"children":[{"data":{"id":"b6yd4ecrezcc","created":1473265750564,"text":"支持3个通配符","expandState":"expand"},"children":[{"data":{"id":"b6yd4sqg0bso","created":1473265781866,"text":"~"},"children":[{"data":{"id":"b6yd5qt4mk8w","created":1473265856039,"text":"~test/ 等同于 $HOME/test"},"children":[]},{"data":{"id":"b6yd6d2nxj40","created":1473265904505,"text":"Win下由环境变量HOME而定"},"children":[]}]},{"data":{"id":"c0ezi8yek6o0","created":1580982454396,"text":"?"},"children":[]},{"data":{"id":"b6yd4w5j40wk","created":1473265789308,"text":"*"},"children":[{"data":{"id":"b6yd6vre5s84","created":1473265945182,"text":"代替一系列文件，如: \nprint: *.c\n    lpr -p $?\n    touch print"},"children":[{"data":{"id":"b6yd9x5ku6wc","created":1473266183309,"text":"$?是一个自动化变量"},"children":[]}]}]}]},{"data":{"id":"c0ezjophdeo0","created":1580982567050,"text":"objects = *.o"},"children":[{"data":{"id":"c0ezkuqh2q00","created":1580982658534,"text":"用在变量在，不会展开为多个.o文件的集合"},"children":[]}]},{"data":{"id":"c0ezlozisb40","created":1580982724385,"text":"objects := $(wildcard *.o)","note":"```\nobjects := $(patsubst %.c,%.o,$(wildcard *.c)) \nfoo : $(objects)\n    cc -o foo $(objects)\n```"},"children":[{"data":{"id":"c0ezlq2eyo80","created":1580982726737,"text":"展开所有的.o文件"},"children":[]}]}]},{"data":{"id":"b6ydedelgkgk","created":1473266532140,"text":"3.4 文件搜寻","expandState":"expand"},"children":[{"data":{"id":"b71dj7qqpwoo","created":1473571591504,"text":"源文件分类存放在不同目录"},"children":[]},{"data":{"id":"b71djkljfyo8","created":1473571619489,"text":"include 带路径的makefile"},"children":[]},{"data":{"id":"b71djz5xjk84","created":1473571651196,"text":"定义VPATH"},"children":[{"data":{"id":"b71dk4nngkoo","created":1473571663151,"text":"VPATH = src : ../header"},"children":[]}]},{"data":{"id":"b71dl6bs5mo0","created":1473571745151,"text":"定义vpath"},"children":[{"data":{"id":"b71dldnr2soo","created":1473571761112,"text":"比VPATH更灵活，不同文件，可以指定不同的目录"},"children":[]},{"data":{"id":"b71dm34fk1cs","created":1473571816540,"text":"三种使用方法"},"children":[{"data":{"id":"b71dmds0aw8o","created":1473571839734,"text":"vpath pattern directories"},"children":[{"data":{"id":"b71dmmj65m0o","created":1473571858790,"text":"vpath %.c foo:../foo2 \n vpath %   blish\n vpath %.h ../headers","expandState":"expand"},"children":[{"data":{"id":"b71dpwqt16w4","created":1473572116112,"text":"如果连续定义多个\n.c文件按上面定义的顺序查找"},"children":[]}]},{"data":{"id":"b71dq7wus740","created":1473572140423,"text":"vpath %.c bar"},"children":[]}]},{"data":{"id":"b71dmvo24wwk","created":1473571878677,"text":"vpath pattern"},"children":[{"data":{"id":"b71dn9uarb40","created":1473571909529,"text":"清除之前定义的 pattern"},"children":[]}]},{"data":{"id":"b71donzyguo8","created":1473572018710,"text":"vpath"},"children":[{"data":{"id":"b71dopjssdss","created":1473572022087,"text":"清除所有已定义好的文件搜索目录"},"children":[]}]}]}]}]},{"data":{"id":"b6ydelkq5zsc","created":1473266549924,"text":"3.5 伪目标","expandState":"expand"},"children":[{"data":{"id":"b71duo9ijrsc","created":1473572489473,"text":"不是文件，而是一个标签"},"children":[]},{"data":{"id":"b71dws0i734k","created":1473572654364,"text":"make无法生成它的依赖关系、决定是否执行"},"children":[]},{"data":{"id":"b71dwv38isws","created":1473572661060,"text":"取名不能与文件名重名，除非声明"},"children":[]},{"data":{"id":"b71dxr74uowg","created":1473572730952,"text":".PHONY可以声明一个伪目标 : \n.PHONY : clean"},"children":[]},{"data":{"id":"b71ekw0fw2ok","created":1473574543807,"text":"同样也可成为依赖"},"children":[{"data":{"id":"b71elqzu2bcw","created":1473574611251,"text":"cleanall : cleanobj cleandiff"},"children":[]}]},{"data":{"id":"b71eh0srl6w4","created":1473574240770,"text":"利用伪目标生成若干可执行文件","note":"```\nall : prog1 prog2 prog3\n.PHONY : all\n\nprog1 : prog1.o utils.o\n    cc -o prog1 prog1.o utils.o\n\nprog2 : prog2.o\n    cc -o prog2 prog2.o\n\nprog3 : prog3.o sort.o utils.o\n    cc -o prog3 prog3.o sort.o utils.o\n    \n```"},"children":[{"data":{"id":"b71ehjfxvtc8","created":1473574281354,"text":"all: prog1 prog2 prog3\n.PHONY : all","note":null},"children":[]}]}]},{"data":{"id":"b6ydeojk3z4k","created":1473266556384,"text":"3.6 多目标","expandState":"expand"},"children":[{"data":{"id":"b71ep4g3t40g","created":1473574875626,"text":"生成多个目标的命令是同一个","note":"```\nbigoutput littleoutput : text.g\n    generate text.g -$(subst output,,$@) > $@\n    \n#上述规则等价于：\n\nbigoutput : text.g\n    generate text.g -big > bigoutput\nlittleoutput : text.g\n    generate text.g -little > littleoutput\n    \n   ```"},"children":[{"data":{"id":"b71escf6hmo0","created":1473575128076,"text":"使用自动化变量$@"},"children":[]}]}]},{"data":{"id":"b6yderkxk204","created":1473266562997,"text":"3.7 静态模式","expandState":"expand"},"children":[{"data":{"id":"b71oe5j76hc8","created":1473602227082,"text":"更加容易地定义多目标规则"},"children":[]},{"data":{"id":"b71lzwoql60o","created":1473595468508,"text":"targets... : target-pattern : prereq-pattern\n    command","note":"```\nobjects = foo.o bar.o\n\nall: $(objects)\n\n$(objects): %.o: %.c\n    $(CC) -c $(CFLAGS) $< -o $@\n    \n```\n依赖模式 %.c 则取模式 %.o 的 % ，也就是 foo bar ，并为其加下 .c 的后缀，于是，我们的依赖目标就 是 foo.c bar.c 。而命令中的 $< 和 $@ 则是自动化变量， $< 表示第一个依赖文件， $@ 表示目标集（也就是“foo.o bar.o”）\n\n上面 的规则展开后等价于下面的规则：\n```\nfoo.o : foo.c\n    $(CC) -c $(CFLAGS) foo.c -o foo.o\nbar.o : bar.c\n    $(CC) -c $(CFLAGS) bar.c -o bar.o\n```"},"children":[]}]},{"data":{"id":"b6ydeu9v5vcw","created":1473266568859,"text":"3.8 自动生成依赖性","expandState":"expand"},"children":[{"data":{"id":"b71prilge00k","created":1473606095361,"text":"main.o : main.c defs.h","expandState":"expand"},"children":[{"data":{"id":"b71prn5fm00k","created":1473606105276,"text":"cc -M main.c\n输出是:main.o : main.c defs.h\n这样一来，你就不必再手动写若干文件的依赖关系"},"children":[]},{"data":{"id":"b71ptb3wdvcw","created":1473606235790,"text":"gcc 需要用 -MM参数，不然，“-M”参数会把一些标准库的头文件也包含进来"},"children":[]}]},{"data":{"id":"b71pvt7800g8","created":1473606431902,"text":"为每一个“name.c”的文件都生成一个“name.d”的Makefile文件","note":"```\n%.d: %.c\n    @set -e; rm -f $@; \\\n    $(CC) -M $(CPPFLAGS) $< > $@.$$$$; \\\n    sed 's,\\($*\\)\\.o[ :]*,\\1.o $@ : ,g' < $@.$$$$ > $@; \\\n    rm -f $@.$$$$\n```\n- 所有的 .d 文件依赖于 .c 文件\n- rm -f $@ 的意思是删除所有的 目标，也就是 .d 文件\n- 为每个依赖文件 $< ，也就是 .c 文件生成依 赖文件， $@ 表示模式 %.d 文件，如果有一个C文件是name.c，那么 % 就是 name ， $$$$ 意为一个随机编号，第二行生成的文件有可能是“name.d.12345”\n- 第三行使 用sed命令做了一个替换，关于sed命令的用法请参看相关的使用文档。\n- 第四行就是删除临时文件\n"},"children":[]}]}]},{"data":{"id":"b6ydf79evdsg","created":1473266597129,"text":"4 Makefile 书写命令","expandState":"collapse"},"children":[{"data":{"id":"b6ydfd4348gs","created":1473266609868,"text":"显示命令"},"children":[{"data":{"id":"c0fo1svp9x40","created":1581051693325,"text":"@echo 正在编译XXX模块......"},"children":[]},{"data":{"id":"c0fo22fojg80","created":1581051714125,"text":"make [-n|--just-print]"},"children":[]},{"data":{"id":"c0fo2tffsh40","created":1581051772883,"text":"make [-s|--slient|--quiet]"},"children":[]}]},{"data":{"id":"b6ydfenvz808","created":1473266613242,"text":"命令执行"},"children":[{"data":{"id":"c0fo50zcqo00","created":1581051946053,"text":"要让上一条命令的结果应用在下一条命令，应使用分号分隔这两条命令","note":"```\nexec:\n    cd /home/hchen; pwd\n```    "},"children":[]}]},{"data":{"id":"b6ydfh83f808","created":1473266618818,"text":"命令出错"},"children":[{"data":{"id":"c0fogbvrxww0","created":1581052831787,"text":"命令出错，则终止所有规则的执行"},"children":[]},{"data":{"id":"c0foglkw5js0","created":1581052852897,"text":"命令前缀减号-，希望即便出错也继续执行下去"},"children":[]},{"data":{"id":"c0fohrddxq80","created":1581052943868,"text":"全局忽略出错"},"children":[{"data":{"id":"c0fohxxfl9s0","created":1581052958141,"text":"make -i|--ignore-errors"},"children":[]}]},{"data":{"id":"c0foib03e6o0","created":1581052986600,"text":"只忽略出错的行，继续执行其它规则"},"children":[{"data":{"id":"c0foiq4zvwo0","created":1581053019548,"text":"make -k|--keep-going"},"children":[]}]}]},{"data":{"id":"b6ydfivji3cc","created":1473266622412,"text":"嵌套执行make"},"children":[{"data":{"id":"c0fok8q4ups0","created":1581053138372,"text":"不同模块或是不同功能的源文件放在不同的目录中，每个目录中有一个Makefile"},"children":[]},{"data":{"id":"c0fokp4aeyo0","created":1581053174057,"text":"make子目录"},"children":[{"data":{"id":"c0fokw2p6ao0","created":1581053189198,"text":"subsystem: \n cd subdir && $(MAKE)"},"children":[]},{"data":{"id":"c0fol9o3erc0","created":1581053218790,"text":"subsystem: \n $(MAKE) -C subdir"},"children":[]}]}]},{"data":{"id":"b6ydfmtozu8s","created":1473266631008,"text":"定义命令包","expandState":"expand"},"children":[{"data":{"id":"c0fon9dmia80","created":1581053374885,"text":"如果Makefile中出现一些相同命令序列，那么我们可以为这些相同的命令序列定义一个命令包"},"children":[]},{"data":{"id":"c0foniburyw0","created":1581053394369,"text":"define run-yacc\nyacc $(firstword $^)\nmv y.tab.c $@\nendef","note":"```\nfoo.c : foo.y\n    $(run-yacc)\n```"},"children":[]}]}]},{"data":{"id":"b6ydft94img4","created":1473266645001,"text":"5 使用变量","expandState":"collapse"},"children":[{"data":{"id":"c0foot15mzs0","created":1581053496031,"text":"变量概述"},"children":[{"data":{"id":"c0fop7hcxls0","created":1581053527486,"text":"变量定义同能用程序中名称定义，大小写敏感"},"children":[]}]},{"data":{"id":"b6ydfynn7tsg","created":1473266656763,"text":"变量的基础"},"children":[{"data":{"id":"c0foqbuzt7k0","created":1581053615382,"text":"变量在声明时需要给予初值"},"children":[]},{"data":{"id":"c0foqe26j7s0","created":1581053620170,"text":"在使用时，需要给在变量名前加上 $ 符号，但最好用小括号 () 或是大括号 {} 把变量给包括起来"},"children":[]},{"data":{"id":"c0foqk86wl40","created":1581053633594,"text":"如果你要使用真实的 $ 字符，那么你需要用 $$ 来表示"},"children":[]}]},{"data":{"id":"b6ydg2ga5y0c","created":1473266665025,"text":"变量中的变量"},"children":[{"data":{"id":"c0fp1654aiw0","created":1581054464939,"text":"定义变量时，可以用其它变量来构建","note":"```\nfoo = $(bar)\nbar = $(ugh)\nugh = Huh?\n\nCFLAGS = $(include_dirs) -O\ninclude_dirs = -Ifoo -Ibar\n\n\nall:\n    echo $(foo)\n```"},"children":[]},{"data":{"id":"c0fp35bqrkg0","created":1581054619891,"text":":=定义变量，只能使用已定义变量，避免无限递归定义","note":"```\ndir := /foo/bar    # directory to put the frobs in\n```\n- 后面还跟了4个空格，如果我们这样使用这样变量来指定别的目 录——“$(dir)/file”那么就完蛋了"},"children":[]},{"data":{"id":"c0fp8aggi9k0","created":1581055022881,"text":"?=定义变量，只有当未定义时才可定义"},"children":[{"data":{"id":"c0fp8ktk1e00","created":1581055045441,"text":"FOO ?= bar"},"children":[]}]}]},{"data":{"id":"b6ydg50lak0s","created":1473266670607,"text":"变量高级用法"},"children":[{"data":{"id":"c0fp9vb9mn40","created":1581055146643,"text":"变量值的共有部分替换","expandState":"expand"},"children":[{"data":{"id":"c0fpdbfpl6g0","created":1581055416833,"text":"变量值的替换","expandState":"expand"},"children":[{"data":{"id":"c0fpapgu2480","created":1581055212284,"text":"$(var:a=b) 或 ${var:a=b}","note":"把变量“var”中所有以“a”字串“结尾”的“a”替换成“b”字串。这里的“结尾”意思是“空格”或是“结束符”"},"children":[]},{"data":{"id":"c0fpcp13al40","created":1581055368060,"text":"foo := a.o b.o c.o\nbar := $(foo:.o=.c)"},"children":[]}]},{"data":{"id":"c0fpdjuspls0","created":1581055435160,"text":"静态模式"},"children":[{"data":{"id":"c0fpdpp2b6g0","created":1581055447874,"text":"foo := a.o b.o c.o\nbar := $(foo:%.o=%.c)"},"children":[]}]}]},{"data":{"id":"c0fpe31wwsg0","created":1581055476949,"text":"把变量的值再当成变量","note":"```\nx = y\ny = z\na := $($(x))\n```"},"children":[]}]},{"data":{"id":"b6ydgair7ywc","created":1473266682590,"text":"追加变量值"},"children":[{"data":{"id":"c0fpgeur6280","created":1581055659366,"text":"objects = main.o foo.o bar.o utils.o\nobjects += another.o"},"children":[]}]},{"data":{"id":"b6ydgff302og","created":1473266693251,"text":"override指示符"},"children":[{"data":{"id":"c0fphxsm1vs0","created":1581055778959,"text":"命令行参数为常量，对该变量赋值会被忽略，可用override方法"},"children":[]},{"data":{"id":"c0fpiotlio00","created":1581055837792,"text":"override <variable>; [=|:=|+=] <value>;"},"children":[]},{"data":{"id":"c0fpjqgv82o0","created":1581055919740,"text":"也可多行定义"},"children":[]}]},{"data":{"id":"b6ydguwh29kw","created":1473266726954,"text":"多行变量","note":"```\necho foo\necho $(bar)\nendef\n```\n- 如果你用define定义的命令变量中没有以 Tab 键开头，那么make 就不会把其认为是命令\n"},"children":[]},{"data":{"id":"b6ydh389f4g8","created":1473266745081,"text":"环境变量"},"children":[]},{"data":{"id":"b6ydh7clfw8w","created":1473266754050,"text":"目标变量"},"children":[]},{"data":{"id":"b6ydh9xq9gws","created":1473266759682,"text":"模式变量"},"children":[{"data":{"id":"c0fppkbmb6o0","created":1581056376547,"text":"给定一种“模式”，可以把变量定义在符 合这种模式的所有目标上","note":"%.o : CFLAGS = -O"},"children":[]}]},{"data":{"id":"c0foc8nuua80","created":1581052511321,"text":"如何调试MAKEFILE变量","hyperlink":"https://coolshell.cn/articles/3790.html","hyperlinkTitle":"如何调试MAKEFILE变量","note":"```\n%:\n        @echo '$*=$($*)'\n \nd-%:\n        @`echo '$*=$($*)'\n        @echo '  origin = $(origin $*)'\n        @echo '   value = $(value  $*)'\n        @echo '  flavor = $(flavor $*)'\n```\n\nmake -f test.mk -f var.mk OBJS\n\n- make的第一个-f后是要测试的makefile，第二个是我们的debug makefile。\n- 后面直接跟变量名，如果在变量名前加”d-“，则输出更为详细的东西。\n\n```shell\n[hchen@RHELSVR5]$ make -f test.mk -f var.mk OBJS\nOBJS=objdir/foo.o objdir/bar.o objdir/baz.o\n \n[hchen@RHELSVR5]$ make -f test.mk -f var.mk d-foo\nfoo=Huh?\n  origin = file\n  value = $(bar)\n  flavor = recursive\n \n[hchen@RHELSVR5]$ make -f test.mk -f var.mk d-CFLAGS\nCFLAGS=-Ifoo -Ibar -O -O\n  origin = file\n  value = -Ifoo -Ibar -O -O\n  flavor = simple\n \n[hchen@RHELSVR5]$  make -f test.mk -f var.mk d-COMPILE.c\nCOMPILE.c=cc -Ifoo -Ibar -O -Wall   -c\n  origin = default\n  flavor = recursive\n   value = $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c\n```\n"},"children":[]}]},{"data":{"id":"b6ydhg2v2cws","created":1473266773053,"text":"6 使用条件判断","expandState":"expand"},"children":[{"data":{"id":"b6ydhltl5cwg","created":1473266785553,"text":"示例","note":"```\nlibs_for_gcc = -lgnu\nnormal_libs =\n\nfoo: $(objects)\nifeq ($(CC),gcc)\n    $(CC) -o foo $(objects) $(libs_for_gcc)\nelse\n    $(CC) -o foo $(objects) $(normal_libs)\nendif\n\n#简洁写法\n\nifeq ($(CC),gcc)\n    libs=$(libs_for_gcc)\nelse\n    libs=$(normal_libs)\nendif\n\n```"},"children":[]},{"data":{"id":"b6ydhn2mqlss","created":1473266788276,"text":"语法"},"children":[]}]},{"data":{"id":"b6ydhs5absow","created":1473266799322,"text":"7 使用函数","expandState":"expand"},"children":[{"data":{"id":"b6ydhwi0km0c","created":1473266808798,"text":"7.1 函数的调用语法","expandState":"collapse"},"children":[{"data":{"id":"c0fpuq69xk00","created":1581056781105,"text":"$(<function> <arguments>)"},"children":[]},{"data":{"id":"c0fpuv5z6f40","created":1581056791971,"text":"${<function> <arguments>}"},"children":[]}]},{"data":{"id":"b6ydi0jzlc00","created":1473266817624,"text":"7.2 字符串处理函数","expandState":"collapse"},"children":[{"data":{"id":"c0fpxzl1ekw0","created":1581057036681,"text":"字符串替换函数"},"children":[{"data":{"id":"c0fpy54xbc00","created":1581057048768,"text":"$(subst <from>,<to>,<text>)"},"children":[]}]},{"data":{"id":"c0fpz3fvh480","created":1581057123440,"text":"模式字符串替换函数","note":"```\n$(patsubst %.c,%.o,$(sources))\n```\n"},"children":[{"data":{"id":"c0fpzan2suw0","created":1581057139113,"text":"$(patsubst <pattern>,<replacement>,<text>)"},"children":[]}]},{"data":{"id":"c0fq1n6bro00","created":1581057323127,"text":"去空格"},"children":[{"data":{"id":"c0fq1u5s5sw0","created":1581057338332,"text":"$(strip <string>)"},"children":[]}]},{"data":{"id":"c0fq2ec50ag0","created":1581057382252,"text":"findstring"},"children":[{"data":{"id":"c0fq2m77aeg0","created":1581057399367,"text":"$(findstring <find>,<in>)"},"children":[]}]},{"data":{"id":"c0fq34sqzz40","created":1581057439852,"text":"filter","note":"```\nsources := foo.c bar.c baz.s ugh.h\nfoo: $(sources)\n    cc $(filter %.c %.s,$(sources)) -o foo\n```"},"children":[{"data":{"id":"c0fq3av0tj40","created":1581057453050,"text":"$(filter <pattern...>,<text>)"},"children":[]}]},{"data":{"id":"c0fq3zb0azk0","created":1581057506260,"text":"filter-out"},"children":[]},{"data":{"id":"c0fq43sjkpc0","created":1581057516027,"text":"sort","note":"给字符串 <list> 中的单词排序（升序）\n会去掉 <list> 中相同的单词"},"children":[{"data":{"id":"c0fq4e7mgps0","created":1581057538707,"text":"$(sort <list>)"},"children":[]}]},{"data":{"id":"c0fq5p1v41k0","created":1581057640667,"text":"word"},"children":[{"data":{"id":"c0fq6eryec00","created":1581057696665,"text":"$(word <n>,<text>)"},"children":[]}]},{"data":{"id":"c0fq6la2mr40","created":1581057710821,"text":"wordlist","expandState":"expand"},"children":[{"data":{"id":"c0fq74j98jk0","created":1581057752735,"text":"$(wordlist <start>,<end>,<text>)","expandState":"expand"},"children":[{"data":{"id":"c0fq6mf5uzc0","created":1581057713305,"text":"取单词串函数"},"children":[]}]}]},{"data":{"id":"c0fq7hsxmb40","created":1581057781618,"text":"words"},"children":[{"data":{"id":"c0fq7l0szs80","created":1581057788625,"text":"$(words <text>)"},"children":[]}]},{"data":{"id":"c0fq7ppwyvc0","created":1581057798850,"text":"firstword"},"children":[{"data":{"id":"c0fq7uq3lrk0","created":1581057809745,"text":"$(firstword <text>)"},"children":[]}]}]},{"data":{"id":"c0fq836exmw0","created":1581057828146,"text":"文件名操作函数","expandState":"collapse"},"children":[{"data":{"id":"c0fq8noayzk0","created":1581057872763,"text":"dir","note":"$(dir src/foo.c hacks) 返回值是 src/ ./ "},"children":[]},{"data":{"id":"c0fq92ofdzk0","created":1581057905422,"text":"notdir","note":"$(notdir src/foo.c hacks) 返回值是 foo.c hacks"},"children":[]},{"data":{"id":"c0fq9o8mvds0","created":1581057952357,"text":"suffix","note":"$(suffix src/foo.c src-1.0/bar.c hacks) 返回值是 .c .c"},"children":[]},{"data":{"id":"c0fqa05kgm00","created":1581057978293,"text":"basename","note":"$(basename src/foo.c src-1.0/bar.c hacks) 返回值是 src/foo src-1.0/bar hacks"},"children":[]},{"data":{"id":"c0fqakkzfc00","created":1581058022760,"text":"addsuffix","note":"$(addsuffix .c,foo bar) 返回值是 foo.c bar.c"},"children":[]},{"data":{"id":"c0fqatd73uo0","created":1581058041881,"text":"addprefix","note":"$(addprefix src/,foo bar) 返回值是 src/foo src/bar"},"children":[]},{"data":{"id":"c0fqb5reoi00","created":1581058068861,"text":"join","note":"$(join aaa bbb , 111 222 333) 返回值是 aaa111 bbb222 333"},"children":[]}]},{"data":{"id":"b6ydi4sktygo","created":1473266826850,"text":"7.4 foreach函数","note":"names := a b c d\n\nfiles := $(foreach n,$(names),$(n).o)"},"children":[{"data":{"id":"c0fqcceue8w0","created":1581058161703,"text":"$(foreach <var>,<list>,<text>)"},"children":[]}]},{"data":{"id":"b6ydi7a7imwc","created":1473266832270,"text":"7.5 if函数"},"children":[{"data":{"id":"c0fqdrsw6jk0","created":1581058273569,"text":"$(if <condition>,<then-part>[,<else-part>])"},"children":[]}]},{"data":{"id":"b6ydib41pfk0","created":1473266840605,"text":"7.6 call函数","note":"reverse =  $(2) $(1)\n\nfoo = $(call reverse,a,b)"},"children":[{"data":{"id":"c0fqg1dt0yo0","created":1581058451153,"text":"$(call <expression>,<parm1>,<parm2>,...,<parmn>)"},"children":[]}]},{"data":{"id":"b6ydie47a4g0","created":1473266847144,"text":"7.7 origin函数"},"children":[{"data":{"id":"c0fqgu77enk0","created":1581058513880,"text":"$(origin <variable>)","note":"告诉你你的这个变量是哪里来\nundefined\n如果 <variable> 从来没有定义过，origin函数返回这个值 undefined\n\ndefault\n如果 <variable> 是一个默认的定义，比如“CC”这个变量，这种变量我们将在后面讲述。\n\nenvironment\n如果 <variable> 是一个环境变量，并且当Makefile被执行时， -e 参数没有被打开。\n\nfile\n如果 <variable> 这个变量被定义在Makefile中。\n\ncommand line\n如果 <variable> 这个变量是被命令行定义的。\n\noverride\n如果 <variable> 是被override指示符重新定义的。\n\nautomatic\n如果 <variable> 是一个命令运行中的自动化变量。关于自动化变量将在后面讲述。\n\n"},"children":[]}]},{"data":{"id":"b6ydje7e4ow0","created":1473266925701,"text":"7.8 shell函数","note":"shell函数把执行操作系统命令后的输出作为函数返回。于是，我们可以用操作 系统命令以及字符串处理命令awk，sed等等命令来生成一个变量\n\n```\ncontents := $(shell cat foo)\nfiles := $(shell echo *.c)\n```"},"children":[]},{"data":{"id":"b6ydiizub1ss","created":1473266857765,"text":"7.9 控制make的函数","note":"你需要检测一些运行Makefile时的运行时信息，并且 根据这些信息来决定，你是让make继续执行，还是停止\n```\nifdef ERROR_001\n    $(error error is $(ERROR_001))\nendif\n```\n\n$(warning <text ...>)\n  \n这个函数很像error函数，只是它并不会让make退出，只是输出一段警告信息，而make继续执行。\n\n\n"},"children":[{"data":{"id":"c0fqj2wdc000","created":1581058689544,"text":"$(error <text ...>)"},"children":[]}]}]},{"data":{"id":"b6ydjusletc0","created":1473266961812,"text":"8 make的运行","expandState":"expand"},"children":[{"data":{"id":"b6ydk0nrv34g","created":1473266974581,"text":"8.1 make的退出码"},"children":[]},{"data":{"id":"b6ydk53qnsw0","created":1473266984255,"text":"8.2 指定Makefile"},"children":[]},{"data":{"id":"b6ydkadnx9ko","created":1473266995738,"text":"8.3 指定目标"},"children":[]},{"data":{"id":"b6ydkftljogk","created":1473267007585,"text":"8.4 检查规则"},"children":[]},{"data":{"id":"b6ydklsd674k","created":1473267020571,"text":"8.5 make的参数"},"children":[]}]},{"data":{"id":"b6ydkts5sdss","created":1473267037973,"text":"9 隐含规则","expandState":"expand"},"children":[{"data":{"id":"b6ydkwia9m8s","created":1473267043906,"text":"9.1 使用隐含规则"},"children":[]},{"data":{"id":"b6ydky69g1cs","created":1473267047533,"text":"9.2 隐含规则一览"},"children":[]},{"data":{"id":"b6ydl465mv40","created":1473267060587,"text":"9.3 隐含规则使用的变量"},"children":[]},{"data":{"id":"b6ydl71y1cwg","created":1473267066863,"text":"9.4 隐含规则链"},"children":[]},{"data":{"id":"b6ydlat5pe88","created":1473267075039,"text":"9.5 定义模式规则"},"children":[]},{"data":{"id":"b6ydle4nkwwk","created":1473267082264,"text":"9.6 老式风格的\"后缀规则\""},"children":[]},{"data":{"id":"b6ydlgy9u6o8","created":1473267088409,"text":"9.7 隐含规则搜索算法"},"children":[]}]},{"data":{"id":"b6ydlk3ybxss","created":1473267095282,"text":"10 使用make更新函数库文件","expandState":"expand"},"children":[{"data":{"id":"b6ydlu9z920c","created":1473267117415,"text":"10.1 函数库文件的成员"},"children":[]},{"data":{"id":"b6ydlyp0wpsg","created":1473267127032,"text":"10.2 函数库成员的隐含规则"},"children":[]},{"data":{"id":"b6ydm71v588w","created":1473267145222,"text":"10.3 函数库文件的后缀规则","layout_right_offset":{"x":0,"y":0}},"children":[]},{"data":{"id":"b6ydmdjool4w","created":1473267159360,"text":"10.4 注意事项"},"children":[]}]}]},"template":"right","theme":"fresh-blue-compat","version":"1.4.43"}