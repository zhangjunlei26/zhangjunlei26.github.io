Title: 第十二章 OPT行为包
Date:  2015-01-01


第十二章 OPT行为包
============================

### 概述

OPT在解决的问题：

* 统一了客户端和服务端的实现模板，避免了跨地域、团队项目可能因沟通协调不适当引起混乱。
* 以一致的方式，正确处理特殊的边界情况和并发相关的错误。
* 提供一种统一的跨系统的方式来处理服务端崩溃的情况，避免没有代码检查引发的风险。

## 一、OPT行为包介绍
  OPT行为包是一种进程设计模式的形式化。以库模块方式实现它们，这些模块 是与标准的Erlang发行版本一起提供的。这些库模块完成所有通胀进程的功能 和错误处理。程序员代码放在一单独模块中，通过一组预定义的回调函数来调用。
  
OPT行为包包括完成实际处理的工作进程和监控进程，其任务是监控工作进程和其它监控进程。
  
行为包模块包括了所有的通用代码，作为OPT发行版本的一部分，能应对多数在你的代码中使用的设计模式。行为包模块提供操作系统所提供的如下通用功能：
 
* 生成或注册进程
* 以同步或异步方式来发送和接收客户消息，包括定义内部的消息协议。
* 存储循环数据和管理循环进程。
* 终止进程。

虽然OPT提供了行为包模块，但程序员必须开发回调模块，用以提供所需要的功能。

## 二、通用服务器
### 1、启动服务器
利用gen_server行为包时，不再使用spawn/spawn_link内置函数，而是使用gen_server:start/4和gen_server_link:start/4函数。
spawn和start之间的主要区别是调用的同步性，使用start，使得工作进程的启动更加确定，以防止意外的竞争状况发生，因为调用将不会返回工作进程的标识符，直到初始化完成。函数原型：

* gen_server:start_link(ServerName, CallBackModule, Arguments,Options)
* gen_server:start(ServerName, CallBackModule, Arguments,Options)
* gen_server:start_link(CallBackModule, Arguments,Options)
* gen_server:start(CallBackModule, Arguments,Options)

上面调用中：

ServerName (服务器名称)

~~~~ 
	格式为{Local, Name} 或 {global,Name}的元组，如果已经注册，表示进程局部或全局名称。如果你不想注册该进程，而使用进程标识符来引用它，那么就省略该参数。
~~~~

其后面三个参数依次为：回调模块、参数、选项，选项是一列表，允许你设置内存管理标记 fullsweep_after/heapsize，以及跟踪和调试标记。大多数的行为包实现只是传递一个空列表。





## 三、监控进程
## 四、应用
## 五、版本发行处理
## 六、其它行为包和更多阅读资源
